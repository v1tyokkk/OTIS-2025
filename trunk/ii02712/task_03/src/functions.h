#pragma once
#include <vector>

const double a = 0.85;
const double b = 0;
const double c = 0.9;
const double d = -0.4;

const double K  = 0.01;
const double T0 = 1;
const double Td = 10;
const double T = 0.5;

const double q0 = K * (1.0 + Td/T0);
const double q1 = -K * (1.0 + 2.0 * Td/T0 - T0/T);
const double q2 = K * Td/T0;

/**
 * @brief Линейная модель объекта управления.
 *
 * Реализует уравнение: y_next = a * y + b * u
 *
 * @param y Текущее значение выходной переменной объекта (например, температура).
 * @param u Текущее значение управляющего воздействия.
 * @return Новое значение выходной переменной на следующем шаге дискретного времени.
 */
double linearModel(double y, double u);

/**
 * @brief Нелинейная модель объекта управления.
 *
 * Реализует уравнение:
 * y_next = a * y - b * (y_pred)^2 + c * u + d * sin(u_pred)
 *
 * Зависит не только от текущих, но и от предыдущих значений выхода и управления.
 *
 * @param y Текущее значение выходной переменной.
 * @param u Текущее значение управляющего воздействия.
 * @param y_pred Предыдущее значение выходной переменной (y на предыдущем шаге).
 * @param u_pred Предыдущее значение управляющего воздействия (u на предыдущем шаге).
 * @return Новое значение выходной переменной на следующем шаге дискретного времени.
 */
double nonlinearModel(double y, double u, double y_pred, double u_pred);

/**
 * @brief Выполняет симуляцию системы управления с ПИД-регулятором и нелинейной моделью объекта.
 *
 * Функция моделирует замкнутую систему автоматического регулирования в течение заданного
 * количества дискретных шагов. Используется рекуррентная форма дискретного ПИД-регулятора
 * и нелинейная динамическая модель объекта управления.
 *
 * Результат возвращается в виде вектора, содержащего последовательные значения выходной
 * переменной y(k) на каждом шаге симуляции.
 *
 * @param w Желаемое значение (setpoint) выходной переменной (например, целевая температура).
 * @param steps Количество шагов дискретного времени для симуляции.
 * @return std::vector<double> Вектор значений выходной переменной y(k) для k = 0..steps-1.
 */
std::vector<double> simulatePIDRegulatorUsingNonLinearModel(double w, int steps);