/**
 * @file main.cpp
 * @brief Точка входа в программу моделирования дискретного PID-регулятора.
 *
 * Программа запрашивает у пользователя параметры модели:
 * - начальную температуру объекта,
 * - коэффициенты линейной модели (a и b),
 * - целевую температуру,
 * - число шагов моделирования.
 *
 * Затем создаёт PID-регулятор, моделирует поведение объекта
 * и выводит результаты каждого шага:
 * - ошибку управления e,
 * - управляющее воздействие u,
 * - текущее состояние объекта y.
 */

#include <iostream>
#include "pid.h"
#include "model.h"

using namespace std;

/**
 * @brief Основная функция моделирования PID-регулятора.
 *
 * Функция выполняет последовательность шагов:
 * 1. Считывание входных параметров пользователя.
 * 2. Инициализация PID-регулятора.
 * 3. Запуск цикла моделирования.
 * 4. Вычисление ошибки e = w - y.
 * 5. Получение управляющего воздействия u.
 * 6. Обновление состояния объекта через линейную модель.
 * 7. Вывод промежуточных результатов.
 *
 * @return Код завершения программы (0 — успешное выполнение).
 */
int main() {
    double y0;  /**< Начальная температура объекта */
    double a1;   /**< Коэффициент модели — сохранение предыдущего состояния */
    double b1;   /**< Коэффициент модели — влияние управляющего воздействия */

    cout << "Enter initial temperature y: ";
    cin >> y0;

    cout << "Enter a and b for linear model: ";
    cin >> a1 >> b1;

    double w;  /**< Целевая температура */
    cout << "Enter target temperature w: ";
    cin >> w;

    int steps; /**< Количество шагов моделирования */
    cout << "Enter number of simulation steps: ";
    cin >> steps;

    // Параметры PID-регулятора
    double K  = 0.4;  /**< Усиление */
    double T  = 3.0;  /**< Время интегрирования */
    double Td = 0.1;  /**< Время дифференцирования */
    double T0 = 1.0;  /**< Шаг дискретизации */

    PID pid(K, T, Td, T0);  /**< Экземпляр PID-регулятора */

    double y = y0; /**< Текущее состояние объекта */

    for (int k = 0; k < steps; k++) {
        double e = w - y;          /**< Ошибка управления */
        double u = pid.compute(e); /**< Управляющее воздействие */
        y = linear(y, u, a1, b1);    /**< Обновлённое состояние объекта */

        cout << "Step " << k
             << "  e=" << e
             << "  u=" << u
             << "  y=" << y << endl;
    }

    return 0;
}
