# Система управления с ПИД-регулятором и моделями объектов

## Summary

| Структуры | Описание |
|-----------|----------|
| `SimulationConfig` | Конфигурация симуляции системы управления |
| `NonlinearModelParams` | Параметры нелинейной математической модели |
| `PIDParameters` | Параметры настройки ПИД-регулятора |

| Функции моделирования | Описание |
|----------------------|----------|
| `simulateLinearModel()` | Симуляция линейной модели объекта |
| `simulateNonLinearModel()` | Симуляция нелинейной модели объекта |
| `saveToCSV()` | Сохранение результатов симуляции в CSV файл |

| Функции управления | Описание |
|-------------------|----------|
| `simulateLinearSystemWithoutPID()` | Моделирование линейной системы без регулятора |
| `simulateLinearSystemWithPID()` | Моделирование линейной системы с ПИД-регулятором |
| `simulateNonLinearSystemWithoutPID()` | Моделирование нелинейной системы без регулятора |
| `simulateNonLinearSystemWithPID()` | Моделирование нелинейной системы с ПИД-регулятором |

| Классы | Описание |
|--------|----------|
| `PIDController` | ПИД-регулятор с анти-windup защитой |

## Структуры данных

### `struct SimulationConfig`
Конфигурация симуляции системы управления.

**Поля:**
- `filename` (std::string) - Имя файла для сохранения результатов
- `initial_y` (double) - Начальное значение выхода системы (по умолчанию 20.0)
- `initial_u` (double) - Начальное управляющее воздействие (по умолчанию 0.0)
- `simulation_time` (int) - Время симуляции в шагах (по умолчанию 100)
- `setpoint` (double) - Заданное значение (уставка) (по умолчанию 25.0)

### `struct NonlinearModelParams`
Параметры нелинейной математической модели.

**Поля:**
- `a` (double) - Линейный коэффициент при y (по умолчанию 0.85)
- `b` (double) - Коэффициент при квадрате предыдущего значения y (по умолчанию 0.01)
- `c` (double) - Коэффициент при входном воздействии u (по умолчанию 0.25)
- `d` (double) - Коэффициент при синусоидальном члене (по умолчанию 0.05)

### `struct PIDParameters`
Параметры настройки ПИД-регулятора.

**Поля:**
- `Kp` (double) - Пропорциональный коэффициент (по умолчанию 1.0)
- `Ki` (double) - Интегральный коэффициент (по умолчанию 0.0)
- `Kd` (double) - Дифференциальный коэффициент (по умолчанию 0.0)
- `min_output` (double) - Минимальное значение выходного сигнала (по умолчанию -1.0)
- `max_output` (double) - Максимальное значение выходного сигнала (по умолчанию 1.0)
- `min_integral` (double) - Минимальное значение интегральной суммы (по умолчанию -10.0)
- `max_integral` (double) - Максимальное значение интегральной суммы (по умолчанию 10.0)
- `dt` (double) - Время дискретизации (шаг регулирования) (по умолчанию 1.0)

## Основные функции моделирования

### `std::vector<double> simulateLinearModel(double y, double u, int t, double a, double b)`
Выполняет симуляцию линейной модели первого порядка вида `y_next = a*y + b*u`.

**Параметры:**
- `y` - Начальное значение выходной переменной
- `u` - Входное воздействие (управляющий сигнал)
- `t` - Время симуляции (количество шагов)
- `a` - Коэффициент при предыдущем значении y
- `b` - Коэффициент при входном воздействии u

**Возвращает:**
Вектор значений выходной переменной на каждом шаге симуляции

### `std::vector<double> simulateNonLinearModel(double y, double u, int t, double a, double b, double c, double d)`
Выполняет симуляцию нелинейной модели вида `y_next = a*y - b*y_prev^2 + c*u + d*sin(u_prev)`.

**Параметры:**
- `y` - Начальное значение выходной переменной
- `u` - Входное воздействие (управляющий сигнал)
- `t` - Время симуляции (количество шагов)
- `a` - Линейный коэффициент при y
- `b` - Коэффициент при квадрате предыдущего значения y
- `c` - Коэффициент при входном воздействии u
- `d` - Коэффициент при синусоидальном члене

**Возвращает:**
Вектор значений выходной переменной на каждом шаге симуляции

## Функции сохранения данных

### `void saveToCSV(const std::string& filename, const std::vector<int>& time, const std::vector<double>& values, const std::vector<double>& controls, double setpoint)`
Сохраняет данные симуляции в CSV файл для последующей визуализации.

**Параметры:**
- `filename` - Имя файла для сохранения
- `time` - Вектор временных меток
- `values` - Вектор значений состояния системы
- `controls` - Вектор управляющих воздействий (опционально)
- `setpoint` - Заданное значение (уставка) (опционально)

## Функции управления системами

### `void simulateLinearSystemWithoutPID(const std::string& filename, double initial_y, double constant_u, int simulation_time, double a, double b)`
Моделирует линейную систему без использования регулятора с постоянным входным воздействием.

**Параметры:**
- `filename` - Имя файла для сохранения результатов
- `initial_y` - Начальное состояние системы
- `constant_u` - Постоянное входное воздействие
- `simulation_time` - Время симуляции
- `a` - Коэффициент при предыдущем значении y
- `b` - Коэффициент при входном воздействии u

### `void simulateLinearSystemWithPID(const std::string& filename, double setpoint, double initial_y, int simulation_time, double a, double b, PIDController& pid)`
Моделирует линейную систему с ПИД-регулятором.

**Параметры:**
- `filename` - Имя файла для сохранения результатов
- `setpoint` - Заданное значение температуры
- `initial_y` - Начальное состояние системы
- `simulation_time` - Время симуляции
- `a` - Коэффициент при предыдущем значении y
- `b` - Коэффициент при входном воздействии u
- `pid` - ПИД-регулятор

### `void simulateNonLinearSystemWithoutPID(const SimulationConfig& config, const NonlinearModelParams& params)`
Моделирует нелинейную систему без использования регулятора.

**Параметры:**
- `config` - Конфигурация симуляции
- `params` - Параметры нелинейной модели

### `void simulateNonLinearSystemWithPID(const SimulationConfig& config, const NonlinearModelParams& params, PIDController& pid)`
Моделирует нелинейную систему с ПИД-регулятором.

**Параметры:**
- `config` - Конфигурация симуляции
- `params` - Параметры нелинейной модели
- `pid` - ПИД-регулятор

## Класс ПИД-регулятора

### `class PIDController`
Реализует дискретный ПИД-регулятор с защитой от windup (насыщения интегральной составляющей).

#### Конструкторы:
```cpp
// Основной конструктор
explicit PIDController(const PIDParameters &param);
```

#### Методы:

##### `double calculate(double setpoint, double measured_value)`
Вычисляет управляющее воздействие на основе текущей ошибки регулирования.

**Параметры:**
- `setpoint` - Заданное значение (уставка)
- `measured_value` - Измеренное текущее значение

**Возвращает:**
Управляющее воздействие (сигнал управления), ограниченное в заданных пределах

**Алгоритм:**
1. Вычисление ошибки: `error = setpoint - measured_value`
2. Пропорциональная составляющая: `P = Kp * error`
3. Интегральная составляющая: `integral += error * dt` с ограничением
4. Дифференциальная составляющая: `D = Kd * (error - prev_error) / dt`
5. Суммирование составляющих: `output = P + Ki*integral + D`
6. Ограничение выходного сигнала

##### `void reset()`
Сбрасывает внутреннее состояние регулятора (обнуляет интегральную сумму и предыдущую ошибку).

##### `void setParameters(double kp, double ki, double kd)`
Устанавливает новые коэффициенты регулятора.

**Параметры:**
- `kp` - Новый пропорциональный коэффициент
- `ki` - Новый интегральный коэффициент
- `kd` - Новый дифференциальный коэффициент

##### `void setOutputLimits(double min, double max)`
Устанавливает ограничения выходного сигнала (защита от перегрузки исполнительных механизмов).

**Параметры:**
- `min` - Минимальное значение выходного сигнала
- `max` - Максимальное значение выходного сигнала

##### `void setIntegralLimits(double min, double max)`
Устанавливает ограничения интегральной суммы (анти-windup защита).

**Параметры:**
- `min` - Минимальное значение интегральной суммы
- `max` - Максимальное значение интегральной суммы